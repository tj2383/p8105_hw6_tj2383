p8105\_hw6\_tj2383
================
Tanvi Jain
11/16/2018

### Problem 1

Importing the homicide dataset from the Washington Post.

``` r
homicide_data = read.csv("./data/homicide-data.csv")
```

In this code chunk I create a `city_state` variable by combining the `city` and `state` variables and a binary variable indicating whether the homicide is solved. I omitted the cities Dallas, TX; Phoenix, AZ; and Kansas City, MO – these don’t report victim race. I also omitted Tulsa, AL – this is a data entry mistake. Next I modifiy `victim_race` to have categories white and non-white, with white as the reference category. Be sure that victim\_age is numeric.

``` r
homicide_data_clean = 
  homicide_data %>% 
  mutate(city_state = paste(city, state, sep = ", ")) %>% 
  select(-city, -state) %>% 
  mutate(case_resolution = as.numeric(disposition == "Closed by arrest")) %>% 
  filter(city_state != "Dallas, TX" & city_state != "Phoenix, AZ" & city_state != "Kansas City, MO" & city_state != "Tulsa, AL") %>% 
  
  mutate(binary_race = case_when(
    victim_race == "Asian" ~ "non-white",
    victim_race == "Black" ~ "non-white",
    victim_race == "Hispanic" ~ "non-white",
    victim_race == "Other" ~ "non-white",
    victim_race == "Unknown" ~ "non-white",
    victim_race == "White" ~ "white"),
    
    victim_race = factor(binary_race, levels = c("white", "non-white")),
    victim_age = as.numeric(as.character(victim_age))
  )
```

    ## Warning in evalq(as.numeric(as.character(victim_age)), <environment>): NAs
    ## introduced by coercion

In this code chunk I use the glm function to fit a logistic regression with `case_resolution` as the outcome and `victim age`, `sex`, and `race` as predictors for Baltimore, MD. I then saved the output of glm as an R object; applied the broom::tidy to this object; and obtained the estimate and confidence interval of the adjusted odds ratio for solving homicides comparing black victims to white victims, keeping all other variables fixed.

``` r
fit_logistic_baltimore = 
  homicide_data_clean %>% 
  filter(city_state == "Baltimore, MD") %>% 
  glm(case_resolution ~ victim_age + victim_race + victim_sex, data = ., family = binomial()) 

fit_logistic_baltimore %>% 
  broom::tidy() %>% 
  janitor::clean_names() %>% 
  mutate(OR = exp(estimate),
         lower_95_limit = exp(estimate - (1.96 * std_error)),
         upper_95_limit = exp(estimate + (1.96 * std_error))) %>%
  filter(term == "victim_racenon-white")
```

    ## # A tibble: 1 x 8
    ##   term  estimate std_error statistic p_value    OR lower_95_limit
    ##   <chr>    <dbl>     <dbl>     <dbl>   <dbl> <dbl>          <dbl>
    ## 1 vict…   -0.820     0.175     -4.69 2.68e-6 0.441          0.313
    ## # ... with 1 more variable: upper_95_limit <dbl>

The odds of having a solved case among those who identify as non-white is 0.44 times the odds of having a solved case among those who identify as white and we are 95% confident that these odds are between 0.31 and 0.62 adjusting for sex and age.

In this code chunk I ran glm for each of the cities in the dataset, and extracted the adjusted odds ratio and 95% CI for solving homicides comparing black victims to white victims. I did this within a “tidy” pipeline, making use of purrr::map, list columns, and unnest.

``` r
nested_glm =
  homicide_data_clean %>% 
  group_by(city_state) %>% 
  nest() %>% 
  mutate(regression_city_state = map(data, ~lm(case_resolution ~ victim_age + victim_sex + victim_race, data = .x)),
         regression_city_state = map(regression_city_state, broom::tidy)) %>% 
  select(-data)

homicides = nested_glm %>% 
  unnest() %>% 
  janitor::clean_names() %>% 
  mutate(OR = exp(estimate),
         lower_95_limit = exp(estimate - (1.96 * std_error)),
         upper_95_limit = exp(estimate + (1.96 * std_error))
  ) %>% 
  filter(term == "victim_racenon-white") %>%
  select(city_state, OR, lower_95_limit, upper_95_limit)
```

This is a dataframe consisting of the estimated ORs and CIs for each city.

| city\_state        |         OR|  lower\_95\_limit|  upper\_95\_limit|
|:-------------------|----------:|-----------------:|-----------------:|
| Albuquerque, NM    |  0.9381364|         0.8439611|         1.0428204|
| Atlanta, GA        |  0.9361747|         0.8236890|         1.0640217|
| Baltimore, MD      |  0.8244697|         0.7623590|         0.8916407|
| Baton Rouge, LA    |  0.9124647|         0.7658194|         1.0871910|
| Birmingham, AL     |  1.0096435|         0.8875775|         1.1484968|
| Boston, MA         |  0.6750011|         0.5871682|         0.7759727|
| Buffalo, NY        |  0.7974480|         0.6934397|         0.9170565|
| Charlotte, NC      |  0.8979433|         0.8115030|         0.9935911|
| Chicago, IL        |  0.8816895|         0.8339958|         0.9321106|
| Cincinnati, OH     |  0.7862386|         0.7028564|         0.8795127|
| Columbus, OH       |  0.9622876|         0.8942863|         1.0354597|
| Denver, CO         |  0.8855921|         0.7829507|         1.0016893|
| Detroit, MI        |  0.9003586|         0.8394328|         0.9657063|
| Durham, NC         |  1.0011652|         0.8138670|         1.2315672|
| Fort Worth, TX     |  0.9583003|         0.8670065|         1.0592071|
| Fresno, CA         |  0.8540912|         0.7505659|         0.9718956|
| Houston, TX        |  0.9667330|         0.9148169|         1.0215953|
| Indianapolis, IN   |  0.8494339|         0.7955435|         0.9069747|
| Jacksonville, FL   |  0.9019509|         0.8440237|         0.9638537|
| Las Vegas, NV      |  0.9366836|         0.8837253|         0.9928155|
| Long Beach, CA     |  0.9488369|         0.8054940|         1.1176886|
| Los Angeles, CA    |  0.9063814|         0.8386239|         0.9796135|
| Louisville, KY     |  0.8062044|         0.7347320|         0.8846294|
| Memphis, TN        |  0.9493614|         0.8722938|         1.0332379|
| Miami, FL          |  0.8806157|         0.7977046|         0.9721444|
| Milwaukee, wI      |  0.9048639|         0.8210219|         0.9972678|
| Minneapolis, MN    |  0.8987154|         0.7707936|         1.0478672|
| Nashville, TN      |  0.9757006|         0.9065794|         1.0500918|
| New Orleans, LA    |  0.8373291|         0.7532570|         0.9307847|
| New York, NY       |  0.8803584|         0.7737717|         1.0016274|
| Oakland, CA        |  0.7216275|         0.6283310|         0.8287769|
| Oklahoma City, OK  |  0.9093793|         0.8332201|         0.9924998|
| Omaha, NE          |  0.7054472|         0.6355823|         0.7829919|
| Philadelphia, PA   |  0.9035855|         0.8466800|         0.9643156|
| Pittsburgh, PA     |  0.7504633|         0.6654925|         0.8462832|
| Richmond, VA       |  0.8626584|         0.7196420|         1.0340969|
| San Antonio, TX    |  0.9150777|         0.8318636|         1.0066159|
| Sacramento, CA     |  0.9467486|         0.8361092|         1.0720285|
| Savannah, GA       |  0.8820030|         0.7340074|         1.0598386|
| San Bernardino, CA |  0.9696966|         0.7992488|         1.1764942|
| San Diego, CA      |  0.8514643|         0.7658733|         0.9466205|
| San Francisco, CA  |  0.8374086|         0.7567119|         0.9267109|
| St. Louis, MO      |  0.8730792|         0.8011558|         0.9514593|
| Stockton, CA       |  0.7867802|         0.6748170|         0.9173200|
| Tampa, FL          |  1.0370698|         0.8754783|         1.2284869|
| Tulsa, OK          |  0.8968168|         0.8273785|         0.9720828|
| Washington, DC     |  0.8547153|         0.7310151|         0.9993476|
