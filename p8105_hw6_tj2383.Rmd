---
title: "p8105_hw6_tj2383"
author: "Tanvi Jain"
date: "11/16/2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
set.seed(1)
```

###Problem 1

Importing the homicide dataset from the Washington Post.
```{r}
homicide_data = read.csv("./data/homicide-data.csv")
```


In this code chunk I create a `city_state` variable by combining the `city` and `state` variables and a binary variable indicating whether the homicide is solved. I omitted the cities Dallas, TX; Phoenix, AZ; and Kansas City, MO – these don’t report victim race. I also omitted Tulsa, AL – this is a data entry mistake. Next I modifiy `victim_race` to have categories white and non-white, with white as the reference category. Be sure that victim_age is numeric.
```{r}
homicide_data_clean = 
  homicide_data %>% 
  mutate(city_state = paste(city, state, sep = ", ")) %>% 
  select(-city, -state) %>% 
  mutate(case_resolution = as.numeric(disposition == "Closed by arrest")) %>% 
  filter(city_state != "Dallas, TX" & city_state != "Phoenix, AZ" & city_state != "Kansas City, MO" & city_state != "Tulsa, AL") %>% 
  
  mutate(binary_race = case_when(
    victim_race == "Asian" ~ "non-white",
    victim_race == "Black" ~ "non-white",
    victim_race == "Hispanic" ~ "non-white",
    victim_race == "Other" ~ "non-white",
    victim_race == "Unknown" ~ "non-white",
    victim_race == "White" ~ "white"),
    
    victim_race = factor(binary_race, levels = c("white", "non-white")),
    victim_age = as.numeric(as.character(victim_age))
  )
```


In this code chunk I use the glm function to fit a logistic regression with `case_resolution` as the outcome and `victim age`, `sex`, and `race` as predictors for Baltimore, MD. I then saved the output of glm as an R object; applied the broom::tidy to this object; and obtained the estimate and confidence interval of the adjusted odds ratio for solving homicides comparing black victims to white victims, keeping all other variables fixed.
```{r}
fit_logistic_baltimore = 
  homicide_data_clean %>% 
  filter(city_state == "Baltimore, MD") %>% 
  glm(case_resolution ~ victim_age + victim_race + victim_sex, data = ., family = binomial()) 

fit_logistic_baltimore %>% 
  broom::tidy() %>% 
  janitor::clean_names() %>% 
  mutate(OR = exp(estimate),
         lower_95_limit = exp(estimate - (1.96 * std_error)),
         upper_95_limit = exp(estimate + (1.96 * std_error))) %>%
  filter(term == "victim_racenon-white")
```
The odds of having a solved case among those who identify as non-white is 0.44 times the odds of having a solved case among those who identify as white and we are 95% confident that these odds are between 0.31 and 0.62
